(function() {
    let data = [];

    // Locate the input field for "mistnost" and get its value
    const roomInput = document.querySelector('input[name="mistnost"]');
    const roomValue = roomInput ? roomInput.value.trim() : "";

    // Add the room value as the first line in the CSV
    if (roomValue) {
        data.push([roomValue, `Místnost: ${roomValue}`]);
    }

    // Select the table with class "zaznamy" and find all rows within it
    document.querySelectorAll('table.zaznamy tr').forEach(row => {
        // Grab the 4th cell (Evidenční číslo) and 5th cell (Name) in each row
        const cells = row.querySelectorAll('td');
        if (cells.length > 4) {
            // Get "Evidenční číslo" and "Name" values
            const evidencniCislo = cells[3].textContent.trim();
            const name = cells[4].textContent.trim();
            if (evidencniCislo && name) {
                data.push([evidencniCislo, name]);
            }
        }
    });

    console.log("Data found:", data);

    // Generate and download CSV with semicolon as separator
    if (data.length > 0) {
        let csvContent = "data:text/csv;charset=utf-8," + data.map(e => e.join(";")).join("\n");
        let encodedUri = encodeURI(csvContent);
        let link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "evidencni_cisla_names.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    } else {
        console.log("No data entries found.");
    }
})();
